#include "scripts/turokgame/components/turokArea.txt"

////////////////////////////////////////////////////
//
// TurokAreaTeleport
//
////////////////////////////////////////////////////

final class TurokAreaTeleport : TurokArea {
    kVec3   position;
    float   facingYaw;
    int     mapID;
    int     sectorNum;
    bool    bEntered;
    
    //
    // TurokAreaTeleport::TurokAreaTeleport
    //
    
    TurokAreaTeleport(kArea @area) {
        super(area);
        bEntered = false;
    }
    
    ~TurokAreaTeleport() {
    }
    
    //
    // TurokAreaTeleport::OnThink
    //
    
    void OnThink(void) {
    }
    
    //
    // TurokAreaTeleport::OnLocalThink
    //
    
    void OnLocalThink(void) {
        // TODO: THIS SHOULD BE HANDLED BY SERVER
        if(bEntered == true && LocalWorld.MapID() == mapID) {
            if(localClient.Puppet().Physics().OnGround()) {
                LocalWorld.TeleportActor(localClient.Puppet(), position, kAngle(facingYaw, 0, 0));
                bEntered = false;
            }
        }
        TurokArea::OnLocalThink();
    }
    
    //
    // TurokAreaTeleport::OnSpawn
    //
    
    void OnSpawn(void) {
        self.key.GetVector("position", position);
        self.key.GetFloat("facingYaw", facingYaw);
        self.key.GetInt("mapID", mapID);
        self.key.GetInt("sectorNum", sectorNum);
        
        TurokArea::OnSpawn();
    }
    
    //
    // TurokAreaTeleport::OnEnter
    //
    
    void OnEnter(void) {
        TurokArea::OnEnter();
        bEntered = true;
    }
    
    //
    // TurokAreaTeleport::OnExit
    //
    
    void OnExit(void) {
        TurokArea::OnExit();
    }
};
